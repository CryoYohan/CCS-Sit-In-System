{% extends 'admindashboardtemplate.html' %}
{% block content %}
<div class="min-h-screen bg-gradient-to-r from-blue-50 to-purple-50 p-8 animate-fadeIn">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8 p-6 bg-white rounded-xl shadow-md animate-slideDown">
        <h1 class="text-3xl font-bold text-gray-800 flex items-center">
            üñ•Ô∏è Manage Laboratories
            <span class="ml-2 text-2xl">üßë‚Äçüíª</span>
        </h1>
        <div class="flex space-x-4">
            <span class="text-2xl">üåü</span>
            <span class="text-2xl">‚öóÔ∏è</span>
        </div>
    </div>

    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden p-8 flex flex-col md:flex-row animate-slideUp">
        <div class="w-full md:w-1/2 p-8 border-r border-gray-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Add Laboratory</h2>
            <form id="labForm" action="#">
                <!-- Laboratory Name -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2" for="labName">
                        Laboratory Name
                    </label>
                    <input
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                        id="lab-name" type="text" placeholder="Enter laboratory name">
                </div>
                <!-- Laboratory Name -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2" for="labName">
                        Laboratory Description
                    </label>
                    <textarea
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                        id="lab-description" type="text" placeholder="Enter laboratory description" required></textarea>
                </div>

                <!-- Days Schedule (Combo Box) -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2" for="labDays">
                        Days Schedule
                    </label>
                    <select
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                        id="day-sched">
                        <option value="MW">MW (Monday & Wednesday)</option>
                        <option value="TTH">TTH (Tuesday & Thursday)</option>
                        <option value="F">F (Friday)</option>
                        <option value="S">S (Saturday)</option>
                        <option value="MWF">MWF (Monday, Wednesday, Friday)</option>
                        <option value="TTHS">TTHS (Tuesday, Thursday, Saturday)</option>
                    </select>
                </div>

                <!-- Time Slots -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2" for="labSchedule">
                        Time Slots
                    </label>
                    <input
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                        id="vacant-time" type="text" placeholder="e.g., 9am-10am, 1pm-2pm">
                    <p class="text-gray-600 text-xs mt-2">Separate multiple time slots with commas.</p>
                </div>

                <!-- Laboratory Picture Upload -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2" for="labPhoto">
                        Upload Laboratory Picture
                    </label>
                    <input type="file" id="image" name="labPhoto"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end">
                    <button type="button" onclick="addLab()"
                        class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition duration-300 shadow-lg">
                        Add Laboratory
                    </button>
                </div>
            </form>
        </div>
        <!-- Right Side: Lab List -->
        <div class="w-full md:w-1/2 p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Laboratories</h2>
            <div class="overflow-y-auto max-h-[calc(100vh-300px)]">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Lab ID</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Lab Name</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Description</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Vacant Time</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Slots</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="labTableBody">
                        <!-- Dynamic Rows fetched by API-->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Adding Laboratory -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>

    document.addEventListener('DOMContentLoaded', function () {
        fetchLaboratories(); // Fetch laboratories on page load
    });

    // Fetch Laboratories from API (Mocked for this example)
    async function fetchLaboratories() {
        const url = `/admin/api/get-laboratories`;
        const response = await fetch(`${url}`);
        if (!response.ok) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to fetch laboratories.',
            });
            return;
        }

        const laboratories = await response.json();
        renderLaboratories(laboratories);
    }

    // Fetch Laboratories from API and render them in the table
    async function renderLaboratories(Laboratories) {
        const labTableBody = document.getElementById('labTableBody');
        labTableBody.innerHTML = ''; // Clear existing rows

        if (Laboratories.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="9" class="text-center py-4 text-gray-500">
                  No laboratories found
                </td>
              </tr>
            `;
            return;
        }

        Laboratories.forEach(lab => {
            const row = document.createElement('tr');
            row.className = 'border-b hover:bg-gray-50 transition duration-200';

            row.innerHTML = `
                <td class="px-4 py-2 text-sm text-gray-700">${lab.lab_id}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${lab.lab_name}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${lab.lab_description}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${lab.vacant_time}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${lab.slots}</td>
                <td class="px-4 py-3 text-sm text-gray-700">
                    <button onclick="openEditModal()" class="text-blue-500 hover:text-blue-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </button>
                    <button 
                    onclick="deleteLab(${lab.lab_id})"
                    class="text-red-500 hover:text-red-700 transition ml-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </td>
            `;

            labTableBody.appendChild(row);
        });
    }

    function addLab() {
        const labName = document.getElementById('lab-name').value.trim();
        const labDescription = document.getElementById('lab-description').value.trim();
        const vacantTime = document.getElementById('vacant-time').value.trim();
        const image = document.getElementById('image').files[0];
        const daySched = document.getElementById('day-sched').value;

        const url = `/admin/api/add-laboratory`;
        const formData = new FormData();

        // ‚úÖ Validate inputs
        if (!labName || !labDescription || !vacantTime || !image || !daySched) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Please fill out all fields and upload a picture.',
            });
            return;
        }

        // ‚úÖ Append form data
        formData.append("lab_name", labName);
        formData.append("lab_description", labDescription);
        formData.append("vacant_time", vacantTime);
        formData.append("day_sched", daySched);
        formData.append("image", image);

        // ‚úÖ Send request using fetch
        fetch(url, {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: data.message,
                    });
                    document.getElementById('labForm').reset();
                    fetchLaboratories();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.message,
                    });
                }
            })
            .catch(error => {
                console.error("Error:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Something went wrong! Please try again.',
                });
            });
    }

</script>

<!-- Animations -->
<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .animate-fadeIn {
        animation: fadeIn 0.8s ease-out forwards;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-slideDown {
        animation: slideDown 0.8s ease-out forwards;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-slideUp {
        animation: slideUp 0.8s ease-out forwards;
    }
</style>
{% endblock %}