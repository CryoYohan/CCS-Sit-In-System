{% extends 'dashboard_template.html' %}
{% block content %}
{% import 'components.html' as component %}
<main class="">
    <div class="grid mb-4 pb-10 px-8 mx-4 rounded-3xl bg-gray-100 border-4 border-gray-400">
        <div class="grid grid-cols-12 gap-6">
            <div class="grid grid-cols-12 col-span-12 gap-6 xxl:col-span-9">
                <div class="col-span-12 mt-8">
                    <div class="flex items-center h-3 intro-y">
                        <h1 class="mr-5 text-lg font-medium truncate">Welcome
                            <span
                                class="bg-clip-text font-bold text-transparent bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 ">
                                {{ student }} | {{ student.course }}-{{ student.year }}
                            </span>
                        </h1>
                    </div>
                    <div class="grid grid-cols-12 gap-6 mt-5">
                        <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white"
                            href="{{ url_for('main.sessions') }}">
                            <div class="p-5">
                                <div class="flex justify-between">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="size-6 h-7 w-7 text-blue-400">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                    </svg>
                                    <div>
                                        {% if (student.session / 30 * 100) >= 70 %}
                                        <span
                                            class="bg-green-500 rounded-full h-6 px-2 flex items-center text-white font-semibold text-sm">
                                            {% elif (student.session / 30 * 100) > 30 %}
                                            <span
                                                class="bg-yellow-500 rounded-full h-6 px-2 flex items-center text-white font-semibold text-sm">
                                                {% else %}
                                                <span
                                                    class="bg-red-500 rounded-full h-6 px-2 flex items-center text-white font-semibold text-sm">
                                                    {% endif %}
                                                    {{ (student.session / 30 * 100) | round | int }}%
                                                </span>

                                    </div>
                                </div>
                                <div class="ml-2 w-full flex-1">
                                    <div>
                                        <div class="mt-3 text-3xl font-bold leading-8">{{ student.session }}</div>

                                        <div class="mt-1 text-base text-gray-600">Sessions Left</div>
                                    </div>
                                </div>
                            </div>
                        </a>
                        <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white"
                            href="{{ url_for('main.reserve') }}">
                            <div class="p-5">
                                <div class="flex justify-between">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="size-6 h-7 w-7 text-yellow-400">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25" />
                                    </svg>

                                    <div
                                        class="bg-red-500 rounded-full h-6 px-2 flex justify-items-center text-white font-semibold text-sm">
                                        <span class="flex items-center">30%</span>
                                    </div>
                                </div>
                                <div class="ml-2 w-full flex-1">
                                    <div>
                                        <div class="mt-3 text-3xl font-bold leading-8">7</div>

                                        <div class="mt-1 text-base text-gray-600">Labs Open</div>
                                    </div>
                                </div>
                            </div>
                        </a>
                        <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white"
                            href="#">
                            <div class="p-5">
                                <div class="flex justify-between">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-pink-600" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
                                    </svg>
                                    <div
                                        class="bg-yellow-500 rounded-full h-6 px-2 flex justify-items-center text-white font-semibold text-sm">
                                        <span class="flex items-center">30%</span>
                                    </div>
                                </div>
                                <div class="ml-2 w-full flex-1">
                                    <div>
                                        <div class="mt-3 text-3xl font-bold leading-8">49</div>

                                        <div class="mt-1 text-base text-gray-600">Total Hours</div>
                                    </div>
                                </div>
                            </div>
                        </a>
                        <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white"
                            href="#">
                            <div class="p-5">
                                <div class="flex justify-between">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-green-400" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
                                    </svg>
                                    <div
                                        class="bg-blue-500 rounded-full h-6 px-2 flex justify-items-center text-white font-semibold text-sm">
                                        <span class="flex items-center">30%</span>
                                    </div>
                                </div>
                                <div class="ml-2 w-full flex-1">
                                    <div>
                                        <div class="mt-3 text-3xl font-bold leading-8">Lab 530</div>

                                        <div class="mt-1 text-base text-gray-600">Top Lab</div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-span-12 mt-5">
                    <div class="grid gap-2 grid-cols-1 lg:grid-cols-2">
                        <div class="bg-white shadow-lg p-4">
                            <h1
                                class="text-2xl font-bold p-2 bg-gradient-to-r from-blue-500 to-pink-500 bg-clip-text text-transparent text-center mb-6">
                                üèõÔ∏è LAB RULES AND REGULATIONS üî¨
                            </h1>

                            <!-- Scrollable Container -->
                            <div
                                class="bg-white shadow-lg rounded-lg p-5 max-w-4xl mx-auto max-h-[70vh] overflow-y-auto scrollbar-thin scrollbar-thumb-blue-500 scrollbar-track-gray-200">
                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-1 mb-4">üìú General Guidelines
                                </h2>
                                <ul class="list-disc list-inside text-gray-600 space-y-2">
                                    <li>‚úÖ Walkmans and other personal pieces of equipment must be switched off.</li>
                                    <li>üïí Games are not allowed inside the lab. This includes computer-related games,
                                        card games, and other games that may disturb the operation of the lab.</li>
                                    <li>üõë Surfing the Internet is allowed only with the permission of the instructor.
                                        Downloading and installing software are strictly prohibited.</li>
                                    <li>üö∏ Accessing websites not related to the course (especially pornographic and
                                        illicit sites) is strictly prohibited.</li>
                                    <li>üîí Deleting computer files and changing the setup of the computer is a major
                                        offense.</li>
                                    <li>‚è≥ Observe computer time usage carefully. A fifteen-minute allowance is given for
                                        each use. Otherwise, the unit will be given to those who wish to "sit-in."</li>
                                </ul>

                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mt-6 mb-4">‚ö†Ô∏è Laboratory
                                    Conduct</h2>
                                <ul class="list-disc list-inside text-gray-600 space-y-2">
                                    <li>üßë‚Äçüè´ Do not enter the lab unless the instructor is present.</li>
                                    <li>üéí All bags, knapsacks, and similar items must be deposited at the counter.</li>
                                    <li>üí∫ Follow the seating arrangement assigned by your instructor.</li>
                                    <li>üñ•Ô∏è At the end of class, all software programs must be closed.</li>
                                    <li>ü™ë Return all chairs to their proper places after use.</li>
                                    <li>üö´ Chewing gum, eating, drinking, smoking, and other forms of vandalism are
                                        prohibited inside the lab.</li>
                                </ul>

                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mt-6 mb-4">üö® Disciplinary
                                    Actions</h2>
                                <ul class="list-disc list-inside text-gray-600 space-y-2">
                                    <li>üîá Anyone causing a continual disturbance will be asked to leave the lab. Acts
                                        or gestures offensive to the community, including public displays of physical
                                        intimacy, are not tolerated.</li>
                                    <li>‚ö†Ô∏è Persons exhibiting hostile or threatening behavior (e.g., yelling, swearing,
                                        or disregarding requests from lab personnel) will be asked to leave the lab.
                                    </li>
                                    <li>üöî For serious offenses, lab personnel may call the Civil Security Office (CSU)
                                        for assistance.</li>
                                    <li>üîß Any technical problems or difficulties must be reported to the laboratory
                                        supervisor, student assistant, or instructor immediately.</li>
                                </ul>

                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mt-6 mb-4">‚öñÔ∏è Disciplinary
                                    Measures</h2>
                                <ul class="list-disc list-inside text-gray-600 space-y-2">
                                    <li>üìù <strong>First Offense:</strong> The Head, Dean, or OIC will recommend
                                        suspension from classes for each offender, in consultation with the Guidance
                                        Center.</li>
                                    <li>üìú <strong>Second and Subsequent Offenses:</strong> A recommendation for a
                                        heavier sanction will be endorsed to the Guidance Center.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="bg-white shadow-lg p-4">
                            <h1
                                class="text-2xl font-bold p-2 bg-gradient-to-r from-blue-500 to-pink-500 bg-clip-text text-transparent text-center mb-6 animate-fadeInUp">
                                üì¢ Announcements ‚ú®
                            </h1>
                            <div id="announcement-container"
                                class="bg-white shadow-lg rounded-lg p-1 max-w-4xl mx-auto max-h-[70vh] overflow-y-auto scrollbar-thin scrollbar-thumb-blue-500 scrollbar-track-gray-200">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    // Fetch announcements when the page loads
    document.addEventListener('DOMContentLoaded', fetchAnnouncements1);

    async function fetchAnnouncements1() {
        try {
            const response = await fetch('/api/announcements', {
                credentials: 'include',  // Include cookies in the request
            });

            if (response.status === 401) {
                // Redirect to login page if unauthorized
                window.location.href = '/login';
                return;
            }

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const announcements = await response.json();

            if (announcements.success) {
                renderAnnouncements1(announcements);
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: announcements.message,
                });
            }
        } catch (error) {
            console.error('Fetch error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: 'Failed to fetch announcements. Please try again later.',
            });
        }
    }

    // Function to render announcements
    function renderAnnouncements1(announcements) {
        const container = document.getElementById('announcement-container');
        container.innerHTML = ''; // Clear existing content
        announcements.data.forEach(announcement => {
            const announcementItem = document.createElement('div');
            announcementItem.className = 'bg-gray-50 p-6 rounded-lg shadow-sm hover:shadow-md transition';

            announcementItem.innerHTML = `
            <div class="flex justify-between items-start">
              <div>
                <h3 class="text-xl font-semibold text-gray-800">${announcement.post_title}</h3>
                <div class="flex justify-between items-center mt-4">
                  <p class="text-blue-400 font-light">Posted by: ${announcement.posted_by}</p>
                  <p class="text-blue-400 font-light">Posted on: ${formatDate(announcement.date_posted)}</p>
                </div>
                <p class="text-gray-600 mt-2">${announcement.post_description}</p>
              </div>
            </div>
            <div class="mt-4">
              <img src="/static/images/announcements/${announcement.image}" alt="Announcement Photo" class="w-full rounded-lg" />
            </div>
          `;

            container.appendChild(announcementItem);
        });

    }

    // Function to delete an announcement
    function deleteAnnouncement(id) {
        fetch(`/api/announcements/${id}`, {
            method: 'DELETE',
        })
            .then(response => {
                if (response.ok) {
                    fetchAnnouncements(); // Refresh the list after deletion
                } else {
                    console.error('Failed to delete the announcement');
                }
            })
            .catch(error => {
                console.error('There was a problem with the delete operation:', error);
            });
    }

    function formatDate(dateString) {
        const date = new Date(dateString);

        // Extract components
        const month = date.toLocaleString('default', { month: 'long' }); // Full month name (e.g., "October")
        const day = date.getDate(); // Day of the month (e.g., 5)
        const year = date.getFullYear(); // Year (e.g., 2023)
        const time = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }); // Time (e.g., "02:30 PM")

        // Format as "Month Day, Year, Time"
        return `${month} ${day}, ${year}, ${time}`;
    }
    function data() {

        return {

            isSideMenuOpen: false,
            toggleSideMenu() {
                this.isSideMenuOpen = !this.isSideMenuOpen
            },
            closeSideMenu() {
                this.isSideMenuOpen = false
            },
            isNotificationsMenuOpen: false,
            toggleNotificationsMenu() {
                this.isNotificationsMenuOpen = !this.isNotificationsMenuOpen
            },
            closeNotificationsMenu() {
                this.isNotificationsMenuOpen = false
            },
            isProfileMenuOpen: false,
            toggleProfileMenu() {
                this.isProfileMenuOpen = !this.isProfileMenuOpen
            },
            closeProfileMenu() {
                this.isProfileMenuOpen = false
            },
            isPagesMenuOpen: false,
            togglePagesMenu() {
                this.isPagesMenuOpen = !this.isPagesMenuOpen
            },

        }
    }
    var chart = document.querySelector('#chartline')
    var options = {
        series: [{
            name: 'TEAM A',
            type: 'area',
            data: [44, 55, 31, 47, 31, 43, 26, 41, 31, 47, 33]
        }, {
            name: 'TEAM B',
            type: 'line',
            data: [55, 69, 45, 61, 43, 54, 37, 52, 44, 61, 43]
        }],
        chart: {
            height: 350,
            type: 'line',
            zoom: {
                enabled: false
            }
        },
        stroke: {
            curve: 'smooth'
        },
        fill: {
            type: 'solid',
            opacity: [0.35, 1],
        },
        labels: ['Dec 01', 'Dec 02', 'Dec 03', 'Dec 04', 'Dec 05', 'Dec 06', 'Dec 07', 'Dec 08', 'Dec 09 ',
            'Dec 10', 'Dec 11'
        ],
        markers: {
            size: 0
        },
        yaxis: [{
            title: {
                text: 'Series A',
            },
        },
        {
            opposite: true,
            title: {
                text: 'Series B',
            },
        },
        ],
        tooltip: {
            shared: true,
            intersect: false,
            y: {
                formatter: function (y) {
                    if (typeof y !== "undefined") {
                        return y.toFixed(0) + " points";
                    }
                    return y;
                }
            }
        }
    };
    var chart = new ApexCharts(chart, options);
    chart.render();

    var chart = document.querySelector('#chartpie')
    var options = {
        series: [44, 55, 67, 83],
        chart: {
            height: 350,
            type: 'radialBar',
        },
        plotOptions: {
            radialBar: {
                dataLabels: {
                    name: {
                        fontSize: '22px',
                    },
                    value: {
                        fontSize: '16px',
                    },
                    total: {
                        show: true,
                        label: 'Total',
                        formatter: function (w) {
                            // By default this function returns the average of all series. The below is just an example to show the use of custom formatter function
                            return 249
                        }
                    }
                }
            }
        },
        labels: ['Apples', 'Oranges', 'Bananas', 'Berries'],
    };
    var chart = new ApexCharts(chart, options);
    chart.render();
</script>
{% endblock %}